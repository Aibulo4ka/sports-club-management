# üìä –°–ø—Ä–∏–Ω—Ç 5 - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç

**–î–∞—Ç–∞:** 10 —è–Ω–≤–∞—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** 70% –∑–∞–≤–µ—Ä—à—ë–Ω (–±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≥–æ—Ç–æ–≤–∞)

---

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Backend (Django REST Framework)

#### –ú–æ–¥–µ–ª–∏
- ‚úÖ `Payment` - –º–æ–¥–µ–ª—å –ø–ª–∞—Ç–µ–∂–∞ —Å –ø–æ–ª—è–º–∏:
  - client, membership, amount
  - status (PENDING, COMPLETED, FAILED, REFUNDED)
  - payment_method (CARD, CASH, YOOKASSA)
  - transaction_id, payment_url
  - created_at, completed_at, notes

#### –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã (`apps/payments/serializers.py`)
- ‚úÖ `PaymentListSerializer` - —Å–ø–∏—Å–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ `PaymentSerializer` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- ‚úÖ `PaymentCreateSerializer` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å—á—ë—Ç–æ–º —Å–∫–∏–¥–æ–∫
- ‚úÖ `PaymentUpdateSerializer` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

#### API ViewSet (`apps/payments/views.py`)
- ‚úÖ `PaymentViewSet` —Å —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏:
  - `GET /api/payments/` - –≤—Å–µ –ø–ª–∞—Ç–µ–∂–∏ (–∞–¥–º–∏–Ω)
  - `GET /api/payments/my/` - –º–æ–∏ –ø–ª–∞—Ç–µ–∂–∏ (–∫–ª–∏–µ–Ω—Ç)
  - `GET /api/payments/{id}/` - –¥–µ—Ç–∞–ª–∏
  - `POST /api/payments/` - —Å–æ–∑–¥–∞–Ω–∏–µ
  - `GET /api/payments/{id}/status_check/` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
  - `POST /api/payments/webhook/` - webhook (–∑–∞–≥–ª—É—à–∫–∞)

#### –í–µ–±-views (`apps/payments/views_web.py`)
- ‚úÖ `my_payments_view` - –∏—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- ‚úÖ `payment_success_view` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—Ö–∞
- ‚úÖ `payment_failed_view` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ—É–¥–∞—á–∏

---

### 2. Frontend (Django Templates)

#### –®–∞–±–ª–æ–Ω—ã
- ‚úÖ `payments/my_payments.html` - –∏—Å—Ç–æ—Ä–∏—è —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É
- ‚úÖ `payments/payment_success.html` - –∫—Ä–∞—Å–∏–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—Ö–∞
- ‚úÖ `payments/payment_failed.html` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—à–∏–±–∫–∏ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

#### URL –º–∞—Ä—à—Ä—É—Ç—ã
- ‚úÖ API: `/api/payments/` (REST API)
- ‚úÖ Web: `/payments/my/` (–∏—Å—Ç–æ—Ä–∏—è)
- ‚úÖ Web: `/payments/success/{id}/` (—É—Å–ø–µ—Ö)
- ‚úÖ Web: `/payments/failed/{id}/` (–Ω–µ—É–¥–∞—á–∞)

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ–æ—Ä–º–∞ –ø–æ–∫—É–ø–∫–∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞ (`memberships/views_web.py`)
  - –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞—ë—Ç –ø–ª–∞—Ç—ë–∂ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞
  - –ê–±–æ–Ω–µ–º–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ SUSPENDED
  - –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ ACTIVE
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ "–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π" –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—é (`base.html`)

---

### 3. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
1. –ö–ª–∏–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç –∞–±–æ–Ω–µ–º–µ–Ω—Ç
2. –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–µ–Ω—É —Å–æ —Å–∫–∏–¥–∫–∞–º–∏ (Strategy Pattern)
3. –°–æ–∑–¥–∞—ë—Ç—Å—è –ø–ª–∞—Ç—ë–∂ (status=PENDING)
4. –°–æ–∑–¥–∞—ë—Ç—Å—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç (status=SUSPENDED)
5. –ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π

#### –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
1. –ü–ª–∞—Ç—ë–∂ –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ COMPLETED
2. `PaymentUpdateSerializer` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∞–±–æ–Ω–µ–º–µ–Ω—Ç
3. Membership.status ‚Üí ACTIVE
4. –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç

#### –†–∞—Å—á—ë—Ç —Å–∫–∏–¥–æ–∫
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω Strategy Pattern –∏–∑ memberships
- ‚úÖ –°–∫–∏–¥–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞–º: 20%
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∫–∏–¥–∫–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ payment.notes

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend
```
backend/apps/payments/
‚îú‚îÄ‚îÄ serializers.py          ‚úÖ –ù–û–í–´–ô - —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ views.py                ‚úÖ –ù–û–í–´–ô - API ViewSet
‚îú‚îÄ‚îÄ views_web.py            ‚úÖ –ù–û–í–´–ô - –≤–µ–±-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ urls.py                 ‚úÖ –û–ë–ù–û–í–õ–Å–ù - API —Ä–æ—É—Ç—ã
‚îî‚îÄ‚îÄ urls_web.py             ‚úÖ –ù–û–í–´–ô - –≤–µ–±-—Ä–æ—É—Ç—ã
```

### Frontend
```
backend/templates/payments/
‚îú‚îÄ‚îÄ my_payments.html        ‚úÖ –ù–û–í–´–ô - –∏—Å—Ç–æ—Ä–∏—è
‚îú‚îÄ‚îÄ payment_success.html    ‚úÖ –ù–û–í–´–ô - —É—Å–ø–µ—Ö
‚îî‚îÄ‚îÄ payment_failed.html     ‚úÖ –ù–û–í–´–ô - –Ω–µ—É–¥–∞—á–∞
```

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
```
backend/config/urls.py                      ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω payments –º–∞—Ä—à—Ä—É—Ç
backend/templates/base.html                 ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –≤ –º–µ–Ω—é
backend/apps/memberships/views_web.py       ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```
SPRINT_5_TESTING.md         ‚úÖ –ù–û–í–´–ô - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
QUICKSTART_SPRINT5.md       ‚úÖ –ù–û–í–´–ô - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
SPRINT_5_SUMMARY.md         ‚úÖ –ù–û–í–´–ô - —ç—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ —Å–µ–π—á–∞—Å

### –°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```
1. –ö–ª–∏–µ–Ω—Ç ‚Üí –í—ã–±–∏—Ä–∞–µ—Ç –∞–±–æ–Ω–µ–º–µ–Ω—Ç
           ‚Üì
2. –°–∏—Å—Ç–µ–º–∞ ‚Üí –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–µ–Ω—É —Å–æ —Å–∫–∏–¥–∫–æ–π (Strategy Pattern)
           ‚Üì
3. –°–∏—Å—Ç–µ–º–∞ ‚Üí –°–æ–∑–¥–∞—ë—Ç Payment (status=PENDING)
           ‚Üì
4. –°–∏—Å—Ç–µ–º–∞ ‚Üí –°–æ–∑–¥–∞—ë—Ç Membership (status=SUSPENDED)
           ‚Üì
5. –ö–ª–∏–µ–Ω—Ç ‚Üí –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ /payments/my/
           ‚Üì
6. –ö–ª–∏–µ–Ω—Ç ‚Üí –í–∏–¥–∏—Ç –ø–ª–∞—Ç—ë–∂ "–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã"
           ‚Üì
7. [–†–£–ß–ù–ê–Ø –ò–ú–ò–¢–ê–¶–ò–Ø] ‚Üí –ê–¥–º–∏–Ω –º–µ–Ω—è–µ—Ç Payment.status –Ω–∞ COMPLETED
           ‚Üì
8. –°–∏—Å—Ç–µ–º–∞ ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç Membership.status –Ω–∞ ACTIVE
           ‚Üì
9. –ö–ª–∏–µ–Ω—Ç ‚Üí –í–∏–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç –≤ "–ú–æ–∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã"
           ‚Üì
10. –ö–ª–∏–µ–Ω—Ç ‚Üí –ú–æ–∂–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –∑–∞–Ω—è—Ç–∏—è
```

---

## ‚è≥ –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ —Ñ–∏–Ω–∞–ª —Å–ø—Ä–∏–Ω—Ç–∞)

### 1. YooKassa API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
**–§–∞–π–ª—ã:** `apps/payments/yookassa_service.py` (–Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å)

**–ó–∞–¥–∞—á–∏:**
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `yookassa` SDK
- [ ] –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å YooKassa API
- [ ] –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å payment_url –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞
- [ ] –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã
- [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ requirements.txt
yookassa==2.3.0
```

**–ü—Ä–∏–º–µ—Ä–Ω—ã–π –∫–æ–¥:**
```python
from yookassa import Configuration, Payment as YKPayment

Configuration.account_id = settings.YOOKASSA_SHOP_ID
Configuration.secret_key = settings.YOOKASSA_SECRET_KEY

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
payment = YKPayment.create({
    "amount": {
        "value": str(amount),
        "currency": "RUB"
    },
    "confirmation": {
        "type": "redirect",
        "return_url": return_url
    },
    "capture": True,
    "description": f"–û–ø–ª–∞—Ç–∞ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞ {membership_type.name}"
})

payment_url = payment.confirmation.confirmation_url
```

---

### 2. Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
**–§–∞–π–ª:** `apps/payments/views.py` (–º–µ—Ç–æ–¥ `webhook` —É–∂–µ –µ—Å—Ç—å, –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å)

**–ó–∞–¥–∞—á–∏:**
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ YooKassa
- [ ] –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –∏–∑ webhook
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
- [ ] –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

**–ü—Ä–∏–º–µ—Ä–Ω—ã–π –∫–æ–¥:**
```python
@action(detail=False, methods=['post'], permission_classes=[])
def webhook(self, request):
    # 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å—å
    # 2. –ò–∑–≤–ª–µ—á—å payment_id –∏–∑ YooKassa
    # 3. –ù–∞–π—Ç–∏ –Ω–∞—à Payment –ø–æ transaction_id
    # 4. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
    # 5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Observer
    pass
```

---

### 3. Observer Pattern –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
**–§–∞–π–ª:** `apps/payments/tasks.py` (–Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å)

**–ó–∞–¥–∞—á–∏:**
- [ ] Celery –∑–∞–¥–∞—á–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Observer Pattern –∏–∑ `core/patterns/observer.py`
- [ ] SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ü—Ä–∏–º–µ—Ä–Ω—ã–π –∫–æ–¥:**
```python
from core.patterns.observer import PaymentSubject, EmailNotifier

@shared_task
def send_payment_confirmation(payment_id):
    payment = Payment.objects.get(id=payment_id)

    subject = PaymentSubject()
    subject.attach(EmailNotifier())

    subject.notify({
        'event': 'payment_completed',
        'payment': payment,
        'client': payment.client
    })
```

---

### 4. Celery –∑–∞–¥–∞—á–∞ –¥–ª—è —Ç–∞–π–º–∞—É—Ç–∞
**–§–∞–π–ª:** `apps/payments/tasks.py`

**–ó–∞–¥–∞—á–∏:**
- [ ] –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- [ ] –û—Ç–º–µ–Ω–∞ PENDING –ø–ª–∞—Ç–µ–∂–µ–π —Å—Ç–∞—Ä—à–µ 30 –º–∏–Ω—É—Ç
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ SUSPENDED –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞

**–ü—Ä–∏–º–µ—Ä–Ω—ã–π –∫–æ–¥:**
```python
@shared_task
def cancel_expired_payments():
    from django.utils import timezone
    from datetime import timedelta

    timeout = timezone.now() - timedelta(minutes=30)

    expired_payments = Payment.objects.filter(
        status=PaymentStatus.PENDING,
        created_at__lt=timeout
    )

    for payment in expired_payments:
        payment.status = PaymentStatus.FAILED
        payment.notes = "–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ–ø–ª–∞—Ç—ã –∏—Å—Ç–µ–∫–ª–æ"
        payment.save()

        # –£–¥–∞–ª–∏—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç
        if payment.membership:
            payment.membership.delete()
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ `config/celery.py`:**
```python
app.conf.beat_schedule = {
    'cancel-expired-payments': {
        'task': 'apps.payments.tasks.cancel_expired_payments',
        'schedule': crontab(minute='*/10'),  # –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
    },
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–°–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤ **SPRINT_5_TESTING.md**

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
1. ‚úÖ –ü–æ–∫—É–ø–∫–∞ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞ ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
2. ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π
3. ‚úÖ –†—É—á–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞
4. ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü—ã —É—Å–ø–µ—Ö–∞/–Ω–µ—É–¥–∞—á–∏
5. ‚úÖ –†–∞—Å—á—ë—Ç —Å–∫–∏–¥–æ–∫

### Unit —Ç–µ—Å—Ç—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å)
```python
# tests/test_payments.py
def test_create_payment_with_discount():
    # –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π —Å—Ç—É–¥–µ–Ω—Ç—É
    pass

def test_activate_membership_on_payment():
    # –¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞
    pass

def test_payment_timeout():
    # –¢–µ—Å—Ç —Ç–∞–π–º–∞—É—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞
    pass
```

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞
- –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã: ~180 —Å—Ç—Ä–æ–∫
- API Views: ~150 —Å—Ç—Ä–æ–∫
- Web Views: ~100 —Å—Ç—Ä–æ–∫
- Templates: ~400 —Å—Ç—Ä–æ–∫
- **–ò—Ç–æ–≥–æ:** ~830 —Å—Ç—Ä–æ–∫

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- Python —Ñ–∞–π–ª—ã: 5
- HTML —à–∞–±–ª–æ–Ω—ã: 3
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: 3
- **–ò—Ç–æ–≥–æ:** 11 —Ñ–∞–π–ª–æ–≤

### API Endpoints
- REST API: 6 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- Web —Å—Ç—Ä–∞–Ω–∏—Ü—ã: 3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã

---

## üéì –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. Strategy Pattern
- **–ì–¥–µ:** –†–∞—Å—á—ë—Ç —Å–∫–∏–¥–æ–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞
- **–§–∞–π–ª:** `apps/memberships/pricing.py`
- **–ö–∞–∫:** `PaymentCreateSerializer` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `get_best_discount_strategy()`

### 2. Observer Pattern (—á–∞—Å—Ç–∏—á–Ω–æ)
- **–ì–¥–µ:** –ì–æ—Ç–æ–≤ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- **–§–∞–π–ª:** `core/patterns/observer.py`
- **–°—Ç–∞—Ç—É—Å:** –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞, –Ω—É–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ webhook

### 3. Singleton Pattern
- **–ì–¥–µ:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ payments –Ω–∞–ø—Ä—è–º—É—é)
- **–§–∞–π–ª:** `core/patterns/singleton.py`

---

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–ø—Ä–∏–Ω—Ç–æ–≤

```
Sprint 1 (–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%
Sprint 2 (CRM & Memberships) ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%
Sprint 3 (–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ)        ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%
Sprint 4 (–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%
Sprint 5 (–ü–ª–∞—Ç–µ–∂–∏)           ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  70%
Sprint 6 (–ê–Ω–∞–ª–∏—Ç–∏–∫–∞)         ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë   0%
```

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å:** ~78% (4.7 –∏–∑ 6 —Å–ø—Ä–∏–Ω—Ç–æ–≤)

---

## üîú –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ó–∞–≤–µ—Ä—à–∏—Ç—å –°–ø—Ä–∏–Ω—Ç 5)
1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è YooKassa API
2. Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
3. Celery –∑–∞–¥–∞—á–∏
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–°–ø—Ä–∏–Ω—Ç 6)
1. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –¥–∞—à–±–æ—Ä–¥
2. –û—Ç—á—ë—Ç—ã
3. –≠–∫—Å–ø–æ—Ä—Ç –≤ 1C
4. Unit —Ç–µ—Å—Ç—ã
5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è YooKassa
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ yookassa.ru
2. –ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ (shop_id –∏ secret_key)
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É: `5555 5555 5555 4477`
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook URL (–Ω—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π –∞–¥—Ä–µ—Å, –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ ngrok)

### –î–ª—è production
1. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î
3. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Sentry
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting –¥–ª—è API
5. –î–æ–±–∞–≤–∏—Ç—å HTTPS (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è YooKassa)

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Ä–µ—Å—É—Ä—Å—ã

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è YooKassa:** https://yookassa.ru/developers
- **Django REST Framework:** https://www.django-rest-framework.org/
- **Celery Docs:** https://docs.celeryproject.org/

---

**–ê–≤—Ç–æ—Ä:** Claude Code Assistant
**–ü—Ä–æ–µ–∫—Ç:** –ê–° –£–°–ö (–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–º –∫–ª—É–±–æ–º)
**–ö—É—Ä—Å:** 3 –∫—É—Ä—Å, –ü–ò, –ö—É—Ä—Å–æ–≤–æ–π –ø—Ä–æ–µ–∫—Ç
