# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ÆKassa

–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

## ‚è±Ô∏è –í—Ä–µ–º—è: ~15 –º–∏–Ω—É—Ç

---

## –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ÆKassa

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://yookassa.ru/
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí API**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - `shopId` (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞)
   - `–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á`

---

## –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª

```bash
cd backend
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:

```bash
# Payment (–ÆKassa)
YOOKASSA_SHOP_ID=–≤–∞—à-shop-id
YOOKASSA_SECRET_KEY=–≤–∞—à-secret-key
```

---

## –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç

### –í–∞—Ä–∏–∞–Ω—Ç A: Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
docker-compose up -d

# –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–ø—É—Å–∫–∞ (10-15 —Å–µ–∫)
docker-compose ps
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –õ–æ–∫–∞–ª—å–Ω–æ

```bash
cd backend

# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ venv
source venv/bin/activate  # Linux/macOS
# –∏–ª–∏
venv\Scripts\activate  # Windows

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
python manage.py runserver
```

---

## –®–∞–≥ 4: –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

```bash
# –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (Docker)
docker-compose exec backend python manage.py create_test_client

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
python manage.py create_test_client
```

–ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω:
- –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç: `test@example.com` / `test123`
- –¢–∏–ø—ã –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ (–µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç)

---

## –®–∞–≥ 5: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã

```bash
# Docker
docker-compose exec backend python test_yookassa_integration.py

# –õ–æ–∫–∞–ª—å–Ω–æ
cd backend
python test_yookassa_integration.py
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
‚úÖ YooKassaService –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
‚úÖ –ü–ª–∞—Ç—ë–∂ —Å–æ–∑–¥–∞–Ω –≤ YooKassa
‚úÖ –ü–ª–∞—Ç—ë–∂ —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ API
‚úÖ Webhook –æ–±—Ä–∞–±–æ—Ç–∞–Ω

–ü—Ä–æ–π–¥–µ–Ω–æ: 3/3 —Ç–µ—Å—Ç–æ–≤
```

---

## –®–∞–≥ 6: –¢–µ—Å—Ç–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞

### –ß–µ—Ä–µ–∑ API (Postman/curl)

```bash
# 1. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω
curl -X POST http://localhost:8000/api/auth/login/ \
  -H "Content-Type: application/json" \
  -d '{"username": "test@example.com", "password": "test123"}'

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ access —Ç–æ–∫–µ–Ω

# 2. –°–æ–∑–¥–∞–π—Ç–µ –ø–ª–∞—Ç—ë–∂
curl -X POST http://localhost:8000/api/payments/ \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -d '{"membership_type_id": 1, "payment_method": "YOOKASSA"}'

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ payment_url –∏–∑ –æ—Ç–≤–µ—Ç–∞
```

### –ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000
2. –í–æ–π–¥–∏—Ç–µ: `test@example.com` / `test123`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã"
4. –ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å"
5. –í–∞—Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ÆKassa

### –û–ø–ª–∞—Ç–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ä—Ç–æ–π

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ÆKassa –≤–≤–µ–¥–∏—Ç–µ:

```
–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã: 5555 5555 5555 4444
–°—Ä–æ–∫: 12/25 (–ª—é–±–æ–π –±—É–¥—É—â–∏–π)
CVC: 123 (–ª—é–±–æ–π)
–ò–º—è: TEST USER
```

–ù–∞–∂–º–∏—Ç–µ "–û–ø–ª–∞—Ç–∏—Ç—å" ‚Üí –≤–∞—Å –≤–µ—Ä–Ω—ë—Ç –Ω–∞ —Å–∞–π—Ç

---

## –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –ß–µ—Ä–µ–∑ Django Admin

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000/admin
2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ü–ª–∞—Ç–µ–∂–∏"
4. –ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–π –ø–ª–∞—Ç—ë–∂ - —Å—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "–û–ø–ª–∞—á–µ–Ω–æ"
5. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã" - —Å—Ç–∞—Ç—É—Å "–ê–∫—Ç–∏–≤–µ–Ω"

### –ß–µ—Ä–µ–∑ API

```bash
curl http://localhost:8000/api/payments/my/ \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ngrok

```bash
# macOS
brew install ngrok

# Windows
# –°–∫–∞—á–∞–π—Ç–µ —Å https://ngrok.com/download
```

### –ó–∞–ø—É—Å–∫ —Ç—É–Ω–Ω–µ–ª—è

```bash
ngrok http 8000
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://abc123.ngrok.io`)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –ÆKassa

1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ÆKassa
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
3. –î–æ–±–∞–≤—å—Ç–µ URL:
   ```
   https://abc123.ngrok.io/api/payments/webhook/
   ```
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ webhook –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

---

## üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

### Docker

```bash
# –í—Å–µ –ª–æ–≥–∏
docker-compose logs -f

# –¢–æ–ª—å–∫–æ backend
docker-compose logs -f backend

# –ü–æ–∏—Å–∫ –ø–æ webhook
docker-compose logs backend | grep webhook
```

### –õ–æ–∫–∞–ª—å–Ω–æ

–õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `python manage.py runserver`

---

## ‚ùì Troubleshooting

### "–û—à–∏–±–∫–∞: Unauthorized"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `YOOKASSA_SHOP_ID` –∏ `YOOKASSA_SECRET_KEY` –≤ `.env`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: `docker-compose restart backend`

### "–ü–ª–∞—Ç—ë–∂ —Å–æ–∑–¥–∞—ë—Ç—Å—è, –Ω–æ —Å—Ç–∞—Ç—É—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è"

**–†–µ—à–µ–Ω–∏–µ:**
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ ngrok (—Å–º. –≤—ã—à–µ)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook URL –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ÆKassa
- –í—Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `GET /api/payments/{id}/status_check/`

### "–¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç"

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ **—Ç–µ—Å—Ç–æ–≤—ã–µ** –¥–∞–Ω–Ω—ã–µ –∏–∑ –ÆKassa
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç —Å —Ñ–ª–∞–≥–æ–º `-v` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- [–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](backend/docs/YOOKASSA_INTEGRATION.md)
- [–ü—Ä–∏–º–µ—Ä—ã API –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞](backend/docs/PAYMENT_API_EXAMPLES.md)
- [–¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –ÆKassa](https://yookassa.ru/developers/payment-acceptance/testing-and-going-live/testing#test-bank-card-details)

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ API
- ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã –ÆKassa
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º (React/Vue)
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ (refunds)
4. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –±–æ–µ–≤–æ–π —Ä–µ–∂–∏–º

---

**–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?** –û—Ç–∫—Ä–æ–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
