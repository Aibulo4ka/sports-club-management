# АС УСК - Автоматизированная система управления спортивным клубом

Веб-приложение для автоматизации всех бизнес-процессов спортивного клуба: управление клиентами, абонементами, расписанием, бронированиями и платежами.

## Описание проекта

Система разрабатывается в рамках курсового проекта и предназначена для:
- **Клиентов:** онлайн-бронирование занятий, покупка абонементов, просмотр расписания
- **Администраторов:** управление клиентами, тренерами, залами, расписанием
- **Тренеров:** просмотр своего расписания, списка клиентов на занятии
- **Руководителя:** аналитика, отчеты, контроль загрузки

## Технологический стек

### Backend
- **Python 3.11+**
- **Django 4.2+** - основной веб-фреймворк
- **Django REST Framework** - RESTful API
- **PostgreSQL 15+** - основная база данных
- **Redis 7+** - кеширование, сессии
- **Celery** - асинхронные задачи (email, напоминания)

### Frontend
- **Django Templates** - серверный рендеринг
- **Bootstrap 5** - UI фреймворк
- **JavaScript/jQuery** - интерактивность

### Внешние интеграции
- **ЮKassa** - платежная система
- **SMTP** - email уведомления
- **1С:Бухгалтерия** - экспорт финансовых данных

### DevOps
- **Docker + Docker Compose** - контейнеризация
- **Git** - контроль версий
- **pytest** - тестирование

## Архитектура

Проект использует паттерны проектирования из лабораторных работ:
- **Singleton** - CacheManager для управления кешем
- **Strategy** - DiscountStrategy для расчета скидок (студенческая, групповая, лояльность)
- **Factory** - ClassFactory для создания разных типов занятий
- **Observer** - NotificationObserver для уведомлений при изменении статусов

## Модель данных (11 сущностей)

Основные таблицы базы данных:
1. **Client** - клиенты клуба
2. **Trainer** - тренеры
3. **MembershipType** - типы абонементов (месячный, годовой, безлимит)
4. **Membership** - купленные абонементы клиентов
5. **ClassType** - типы занятий (йога, фитнес, бокс, плавание)
6. **Class** - конкретные занятия в расписании
7. **Room** - залы/помещения
8. **Schedule** - расписание занятий
9. **Booking** - бронирования клиентов
10. **Visit** - фактические посещения
11. **Payment** - платежи

Подробная ER-диаграмма представлена в ЛР6.

## Установка и запуск

### Требования
- Python 3.11+
- PostgreSQL 15+
- Redis 7+
- Docker и Docker Compose (опционально)

### Вариант 1: Запуск с Docker (рекомендуется)

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd Курсовой_проект
```

2. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
# Отредактируйте .env и укажите свои настройки
```

3. Запустите контейнеры:
```bash
docker-compose up -d
```

4. Примените миграции:
```bash
docker-compose exec backend python manage.py migrate
```

5. Создайте суперпользователя:
```bash
docker-compose exec backend python manage.py createsuperuser
```

6. Откройте браузер:
- Приложение: http://localhost:8000
- Админ-панель: http://localhost:8000/admin

### Вариант 2: Локальная установка

1. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
```

2. Установите зависимости:
```bash
cd backend
pip install -r requirements.txt
```

3. Создайте файл `.env` (см. `.env.example`)

4. Запустите PostgreSQL и Redis локально

5. Примените миграции:
```bash
python manage.py migrate
```

6. Создайте суперпользователя:
```bash
python manage.py createsuperuser
```

7. Запустите сервер разработки:
```bash
python manage.py runserver
```

8. В отдельном терминале запустите Celery:
```bash
celery -A config worker -l info
celery -A config beat -l info
```

## Структура проекта

```
Курсовой_проект/
├── backend/                      # Django приложение
│   ├── config/                   # Настройки проекта
│   │   ├── settings/
│   │   │   ├── base.py          # Базовые настройки
│   │   │   ├── dev.py           # Настройки разработки
│   │   │   └── prod.py          # Настройки продакшена
│   │   ├── urls.py              # URL маршруты
│   │   └── wsgi.py
│   ├── apps/                     # Django приложения
│   │   ├── accounts/            # Аутентификация (Client, Trainer, Admin)
│   │   ├── memberships/         # Абонементы (Membership, MembershipType)
│   │   ├── classes/             # Занятия (Class, ClassType, Schedule)
│   │   ├── bookings/            # Бронирования (Booking, Visit)
│   │   ├── payments/            # Платежи (Payment)
│   │   ├── facilities/          # Залы (Room)
│   │   └── analytics/           # Аналитика и отчеты
│   ├── core/                     # Общие утилиты
│   │   ├── patterns/            # Design patterns
│   │   │   ├── singleton.py     # CacheManager
│   │   │   ├── strategy.py      # DiscountStrategy
│   │   │   ├── factory.py       # ClassFactory
│   │   │   └── observer.py      # NotificationObserver
│   │   └── utils/
│   ├── templates/                # Django шаблоны
│   ├── static/                   # Статические файлы (CSS, JS, изображения)
│   ├── media/                    # Загруженные файлы
│   └── manage.py
├── frontend/                     # (будущее: React приложение)
├── database/
│   ├── schema.sql               # PostgreSQL schema из ЛР6
│   ├── migrations/              # История миграций
│   └── seeds/                   # Тестовые данные
├── docs/
│   ├── IMPLEMENTATION_PLAN.md   # Детальный план реализации (6 спринтов)
│   ├── api_specification.md     # API документация
│   └── architecture.md          # Архитектурные решения
├── tests/
│   ├── unit/                    # Юнит-тесты
│   ├── integration/             # Интеграционные тесты
│   └── e2e/                     # End-to-end тесты
├── docker-compose.yml           # Docker конфигурация
├── .env.example                 # Пример переменных окружения
├── .gitignore
├── requirements.txt
└── README.md
```

## Основные функции

### Для клиентов:
- ✅ Регистрация и вход в систему
- ✅ Просмотр расписания занятий (календарь, фильтры)
- ✅ Бронирование занятий (с проверкой наличия мест)
- ✅ Отмена бронирования (до 24 часов)
- ✅ Покупка абонементов онлайн (ЮKassa)
- ✅ Система скидок (студенческая 20%, групповая 15%, лояльность 10%)
- ✅ Личный кабинет (профиль, абонементы, бронирования, платежи)
- ✅ Email/SMS уведомления (напоминание за 2 часа)

### Для администраторов:
- ✅ Управление клиентами (CRUD)
- ✅ Управление тренерами (CRUD)
- ✅ Управление залами (CRUD)
- ✅ Создание расписания занятий
- ✅ Управление типами абонементов
- ✅ Просмотр бронирований
- ✅ Отметка посещений
- ✅ Dashboard с аналитикой:
  - Количество клиентов (всего, новых за месяц)
  - Выручка по дням/неделям/месяцам
  - Популярные занятия (топ-5)
  - Загрузка тренеров
  - Процент посещаемости
- ✅ Экспорт данных в 1С:Бухгалтерия

### Для тренеров:
- ✅ Просмотр своего расписания
- ✅ Список клиентов на занятии
- ✅ Отметка посещений

## План разработки (6 спринтов)

Проект разрабатывается по методологии Agile (Scrum) за 3 месяца:

- **Спринт 1 (недели 1-2):** Инфраструктура, модели, аутентификация
- **Спринт 2 (недели 3-4):** CRM, управление абонементами
- **Спринт 3 (недели 5-6):** Расписание занятий
- **Спринт 4 (недели 7-8):** Система бронирования
- **Спринт 5 (недели 9-10):** Интеграция платежей
- **Спринт 6 (недели 11-12):** Аналитика, тесты, релиз

Подробный план с задачами: [IMPLEMENTATION_PLAN.md](./docs/IMPLEMENTATION_PLAN.md)

## API Endpoints

### Аутентификация
```
POST /api/auth/register/          # Регистрация
POST /api/auth/login/             # Вход
POST /api/auth/logout/            # Выход
POST /api/auth/refresh/           # Обновление токена
```

### Клиенты (админ)
```
GET    /api/clients/              # Список клиентов
POST   /api/clients/              # Добавить клиента
GET    /api/clients/{id}/         # Детали клиента
PUT    /api/clients/{id}/         # Обновить клиента
DELETE /api/clients/{id}/         # Удалить клиента
```

### Абонементы
```
GET  /api/memberships/types/      # Типы абонементов (каталог)
GET  /api/memberships/my/         # Мои абонементы
POST /api/memberships/purchase/   # Купить абонемент
```

### Расписание
```
GET /api/classes/                 # Все занятия
GET /api/classes/?date=2025-11-01 # По дате
GET /api/classes/?trainer_id=5    # По тренеру
GET /api/classes/{id}/            # Детали занятия
POST /api/classes/                # Создать занятие (админ)
```

### Бронирования
```
POST   /api/bookings/             # Создать бронирование
GET    /api/bookings/my/          # Мои бронирования
DELETE /api/bookings/{id}/cancel/ # Отменить бронирование
```

### Платежи
```
POST /api/payments/create/        # Создать платеж (redirect на ЮKassa)
POST /api/payments/webhook/       # Webhook от ЮKassa
GET  /api/payments/my/            # История платежей
```

### Аналитика (админ)
```
GET /api/analytics/dashboard/     # Общая статистика
GET /api/analytics/revenue/       # Выручка
GET /api/analytics/popular/       # Популярные занятия
```

## Тестирование

### Статистика тестов:
- **Всего тестов:** 239
- **Успешных:** 162 (67.8%)
- **Покрытие кода:** 25.52%
- **Паттерны проектирования:** 93% покрыты тестами

### Запуск тестов:
```bash
# Все тесты (239 штук)
pytest

# С покрытием
pytest --cov=apps --cov-report=html

# Только unit-тесты
pytest -m unit

# Только тесты паттернов
pytest -m patterns

# Конкретное приложение
pytest apps/bookings/tests/

# В Docker
docker-compose exec backend pytest -v
```

Подробнее:
- [RUN_TESTS.md](./backend/RUN_TESTS.md) - инструкция по запуску
- [TESTING_REPORT.md](./backend/TESTING_REPORT.md) - полный отчёт о тестировании

## Разработка

### Создание нового приложения Django
```bash
python manage.py startapp app_name
# Добавить в INSTALLED_APPS в config/settings/base.py
```

### Создание миграций
```bash
python manage.py makemigrations
python manage.py migrate
```

### Создание суперпользователя
```bash
python manage.py createsuperuser
```

### Сбор статики
```bash
python manage.py collectstatic
```

### Code style
```bash
# Форматирование
black .
isort .

# Проверка
flake8 .
```

## Документация

- [План реализации](./docs/IMPLEMENTATION_PLAN.md) - детальный план на 6 спринтов
- [ЛР1.pdf](../ЛР1.pdf) - методология разработки (Agile)
- [ЛР5.pdf](../ЛР5.pdf) - архитектурные стили и модели данных
- [ЛР6.html](../ЛР6.html) - ER-диаграммы базы данных
- [ЛР7.html](../ЛР7.html) - анализ качества аналога (Mindbody)
- [Lr3/](../Lr3/) - примеры паттернов проектирования в Django

## Команда разработки

- **Backend Developer** - разработка API, бизнес-логики
- **Frontend Developer** - разработка UI/UX
- **QA Engineer** - тестирование, документация

## Оценка проекта

- **Функциональные точки:** 55 FP
- **Трудозатраты:** 440 person-hours
- **Длительность:** 12 недель (3 месяца)
- **Команда:** 3 человека
- **Бюджет:** ~1,45M рублей (с аутсорсом)

## Лицензия

Курсовой проект, 3 курс, ПИ.

## Контакты

Для вопросов и предложений обращайтесь к команде разработки.

---

**Статус проекта:** ✅ Спринт 5 завершён (Платежи + Тесты)

**Последнее обновление:** 2025-11-17

### Что реализовано:
- ✅ Спринт 1: Инфраструктура, Docker, БД, модели, авторизация (JWT)
- ✅ Спринт 2: CRM система, управление клиентами/тренерами
- ✅ Спринт 3: Расписание занятий, календарь
- ✅ Спринт 4: Система бронирований, уведомления (Celery)
- ✅ Спринт 5: Интеграция ЮKassa, платежи, **239 pytest тестов**

### Следующие шаги:
- ⏳ Спринт 6: Аналитика, dashboard, финальная полировка
